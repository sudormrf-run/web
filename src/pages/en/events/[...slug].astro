---
import Layout from '../../../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { useTranslations } from '../../../i18n/utils';

const locale = 'en';
const { t } = useTranslations(locale);

export async function getStaticPaths() {
  const events = await getCollection('events', ({ slug }) => slug.startsWith('ko/'));
  return events.map((event) => ({
    params: { slug: event.slug.replace('ko/', '') },
    props: { event },
  }));
}

interface Props {
  event: CollectionEntry<'events'>;
}

const { event } = Astro.props;
const { Content } = await event.render();
const { data } = event;

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    weekday: 'long',
  });
};

const dateDisplay = data.endDate
  ? `${formatDate(data.date)} ~ ${formatDate(data.endDate)}`
  : formatDate(data.date);

const isPast = data.status === 'past';
const isUpcoming = data.status === 'upcoming';
---

<Layout title={data.title} locale={locale}>
  <article class="event-page">
    <div class="container">
      <!-- Hero Section -->
      <header class="event-header">
        {data.poster && (
          <div class="event-poster">
            <img src={data.poster} alt={data.title} />
          </div>
        )}

        <div class="event-header-content">
          <div class="event-badges">
            {isPast && <span class="badge past-badge">Past Event</span>}
            {isUpcoming && <span class="badge upcoming-badge">Upcoming</span>}
            {data.isFeatured && <span class="badge featured-badge">Featured</span>}
          </div>

          <h1 class="event-title">{data.title}</h1>

          <div class="event-meta-grid">
            <div class="meta-item">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <div>
                <span class="meta-label">Date</span>
                <span class="meta-value">{dateDisplay}</span>
                {data.time && <span class="meta-sub">{data.time}</span>}
              </div>
            </div>

            <div class="meta-item">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <div>
                <span class="meta-label">Location</span>
                <span class="meta-value">{data.location}</span>
              </div>
            </div>

            {data.hosts && data.hosts.length > 0 && (
              <div class="meta-item">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <div>
                  <span class="meta-label">Hosts</span>
                  <span class="meta-value">{data.hosts.join(', ')}</span>
                </div>
              </div>
            )}
          </div>

          <!-- Action Buttons -->
          <div class="event-actions">
            {isUpcoming && data.registrationUrl && (
              <a href={data.registrationUrl} target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                </svg>
                Register Now
              </a>
            )}
            {data.youtubeUrl && (
              <a href={data.youtubeUrl} target="_blank" rel="noopener noreferrer" class="btn btn-youtube">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z" />
                  <path fill="white" d="M9.545 15.568V8.432L15.818 12l-6.273 3.568z" />
                </svg>
                {isPast ? 'Watch Recording' : 'Watch Live'}
              </a>
            )}
            {data.blogUrl && (
              <a href={data.blogUrl} target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                </svg>
                Read Review
              </a>
            )}
          </div>
        </div>
      </header>

      <!-- Speakers Section -->
      {data.speakers && data.speakers.length > 0 && (
        <section class="event-section speakers-section">
          <h2 class="section-title">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Speakers
          </h2>
          <div class="speakers-grid">
            {data.speakers.map((speaker) => (
              <div class="speaker-card">
                <div class="speaker-avatar">
                  <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
                <div class="speaker-info">
                  <h3 class="speaker-name">{speaker.name}</h3>
                  {speaker.affiliation && (
                    <p class="speaker-affiliation">{speaker.affiliation}</p>
                  )}
                  {speaker.topic && (
                    <p class="speaker-topic">{speaker.topic}</p>
                  )}
                </div>
              </div>
            ))}
          </div>
        </section>
      )}

      <!-- Main Content -->
      <section class="event-section content-section">
        <div class="prose">
          <Content />
        </div>
      </section>

      <!-- YouTube Embed for past events -->
      {isPast && data.youtubeUrl && (
        <section class="event-section video-section">
          <h2 class="section-title">
            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z" />
              <path fill="white" d="M9.545 15.568V8.432L15.818 12l-6.273 3.568z" />
            </svg>
            Watch Recording
          </h2>
          <div class="video-container">
            <iframe
              src={`https://www.youtube.com/embed/${data.youtubeUrl.split('v=')[1]?.split('&')[0] || data.youtubeUrl.split('/').pop()}`}
              title={data.title}
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
            ></iframe>
          </div>
        </section>
      )}

      <!-- Gallery Section -->
      {data.gallery && data.gallery.length > 0 && (
        <section class="event-section gallery-section">
          <h2 class="section-title">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Gallery
          </h2>
          <div class="gallery-grid">
            {data.gallery.map((videoId) => (
              <div class="gallery-item video-item">
                <iframe
                  src={`https://www.youtube.com/embed/${videoId}`}
                  title="Gallery video"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                ></iframe>
              </div>
            ))}
          </div>
        </section>
      )}

      <!-- Tags -->
      {data.tags && data.tags.length > 0 && (
        <div class="event-tags">
          {data.tags.map((tag) => (
            <span class="tag">#{tag}</span>
          ))}
        </div>
      )}

      <!-- Back Button -->
      <div class="back-link">
        <a href="/en/events">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Back to Events
        </a>
      </div>
    </div>
  </article>
</Layout>

<style>
  .event-page {
    padding: 2rem 0 4rem;
  }

  /* Header */
  .event-header {
    display: grid;
    gap: 2rem;
    margin-bottom: 3rem;
  }

  @media (min-width: 768px) {
    .event-header {
      grid-template-columns: 1fr 1fr;
      align-items: start;
    }
  }

  .event-poster {
    border-radius: var(--radius-xl);
    overflow: hidden;
    background: var(--color-bg-secondary);
  }

  .event-poster img {
    width: 100%;
    height: auto;
    display: block;
  }

  .event-header-content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .event-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .past-badge {
    background: rgba(67, 214, 168, 0.2);
    color: var(--color-green);
  }

  .upcoming-badge {
    background: rgba(253, 115, 24, 0.2);
    color: var(--color-accent);
  }

  .featured-badge {
    background: rgba(95, 173, 254, 0.2);
    color: var(--color-blue);
  }

  .event-title {
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 800;
    line-height: 1.2;
    color: var(--color-text-primary);
  }

  .event-meta-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .meta-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    color: var(--color-text-muted);
  }

  .meta-item svg {
    flex-shrink: 0;
    color: var(--color-accent);
    margin-top: 0.125rem;
  }

  .meta-item div {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .meta-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
  }

  .meta-value {
    font-size: 0.9375rem;
    color: var(--color-text-primary);
  }

  .meta-sub {
    font-size: 0.875rem;
    color: var(--color-green);
  }

  /* Action Buttons */
  .event-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-top: 0.5rem;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    transition: all 0.3s;
  }

  .btn-primary {
    background: var(--color-accent);
    color: white;
  }

  .btn-primary:hover {
    background: #e5660f;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(253, 115, 24, 0.4);
  }

  .btn-youtube {
    background: #ff0000;
    color: white;
  }

  .btn-youtube:hover {
    background: #cc0000;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 0, 0, 0.4);
  }

  .btn-secondary {
    background: var(--color-surface);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
  }

  .btn-secondary:hover {
    background: var(--color-bg-secondary);
    border-color: var(--color-border-hover);
  }

  /* Sections */
  .event-section {
    margin-bottom: 3rem;
  }

  .section-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-accent);
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--color-border);
  }

  /* Speakers */
  .speakers-grid {
    display: grid;
    gap: 1rem;
  }

  @media (min-width: 640px) {
    .speakers-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .speaker-card {
    display: flex;
    gap: 1rem;
    padding: 1.25rem;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
  }

  .speaker-avatar {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 56px;
    height: 56px;
    background: var(--color-bg-secondary);
    border-radius: 50%;
    color: var(--color-text-muted);
    flex-shrink: 0;
  }

  .speaker-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .speaker-name {
    font-size: 1rem;
    font-weight: 700;
    color: var(--color-text-primary);
  }

  .speaker-affiliation {
    font-size: 0.875rem;
    color: var(--color-green);
  }

  .speaker-topic {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-top: 0.25rem;
  }

  /* Content */
  .prose {
    color: var(--color-text-secondary);
    line-height: 1.8;
  }

  .prose :global(h2) {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .prose :global(h3) {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-accent);
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }

  .prose :global(p) {
    margin-bottom: 1rem;
  }

  .prose :global(ul),
  .prose :global(ol) {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }

  .prose :global(li) {
    margin-bottom: 0.5rem;
  }

  .prose :global(a) {
    color: var(--color-accent);
    text-decoration: underline;
  }

  .prose :global(a:hover) {
    color: var(--color-green);
  }

  .prose :global(strong) {
    color: var(--color-text-primary);
    font-weight: 600;
  }

  .prose :global(blockquote) {
    border-left: 3px solid var(--color-accent);
    padding-left: 1rem;
    margin: 1.5rem 0;
    color: var(--color-text-muted);
    font-style: italic;
  }

  /* Video */
  .video-container {
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
    border-radius: var(--radius-lg);
    background: var(--color-bg-secondary);
  }

  .video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  /* Gallery */
  .gallery-grid {
    display: grid;
    gap: 1rem;
  }

  @media (min-width: 640px) {
    .gallery-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .gallery-item {
    aspect-ratio: 16 / 9;
    overflow: hidden;
    border-radius: var(--radius-lg);
    background: var(--color-bg-secondary);
  }

  .gallery-item iframe {
    width: 100%;
    height: 100%;
  }

  /* Tags */
  .event-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 2rem;
  }

  .tag {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    padding: 0.25rem 0.75rem;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
  }

  /* Back Link */
  .back-link {
    padding-top: 2rem;
    border-top: 1px solid var(--color-border);
  }

  .back-link a {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--color-text-muted);
    font-weight: 500;
    transition: color 0.2s;
  }

  .back-link a:hover {
    color: var(--color-accent);
  }
</style>
