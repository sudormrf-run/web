---
import Layout from '../../../../layouts/Layout.astro';
import GraphView from '../../../../components/GraphView.astro';
import { getCollection } from 'astro:content';
import { useTranslations } from '../../../../i18n/utils';
import { generateGraphData, getTagCounts } from '../../../../utils/graphData';

const locale = 'en';
const { t } = useTranslations(locale);

// Get all knowledge content for Korean
const allKnowledge = await getCollection('knowledge', ({ slug }) => slug.startsWith('en/'));

// Filter to only actual content (not category index pages)
const contentItems = allKnowledge.filter(item => {
  const segments = item.slug.split('/');
  return segments.length >= 3;
});

// Generate graph data
const graphData = generateGraphData(contentItems, locale);

// Get tag counts for tag cloud
const tagCounts = getTagCounts(contentItems);
const sortedTags = Array.from(tagCounts.entries())
  .sort((a, b) => b[1] - a[1]); // Sort by count descending

// Categories configuration
const categories = [
  { id: 'essays', name: 'Essays', color: 'yellow', description: 'In-depth analysis and thoughts on Physical AI' },
  { id: 'models', name: 'Models', color: 'blue', description: 'Major AI models including VLA, RFM, and more' },
  { id: 'companies', name: 'Companies', color: 'green', description: 'Key companies developing Physical AI' },
  { id: 'hardware', name: 'Hardware', color: 'purple', description: 'Robots, sensors, and hardware platforms' },
  { id: 'people', name: 'People', color: 'pink', description: 'Leading researchers in the field' },
];

// Hardware subcategories
const hardwareSubcategories = [
  { id: 'humanoids', name: 'Humanoids' },
  { id: 'quadrupeds', name: 'Quadrupeds' },
  { id: 'arms', name: 'Robot Arms' },
  { id: 'hands', name: 'Robot Hands' },
  { id: 'mobile', name: 'Mobile' },
  { id: 'misc', name: 'Misc' },
];

// Group content by category
const groupedContent = categories.map(category => {
  const items = contentItems
    .filter(item => item.data.category === category.id)
    .sort((a, b) => a.data.title.localeCompare(b.data.title, 'ko'));

  // For hardware, group by subcategory
  let subcategories = null;
  if (category.id === 'hardware') {
    subcategories = hardwareSubcategories.map(sub => {
      const subItems = items.filter(item => {
        const slugParts = item.slug.split('/');
        return slugParts.length >= 4 && slugParts[2] === sub.id;
      });
      return { ...sub, items: subItems };
    }).filter(sub => sub.items.length > 0);
  }

  return { ...category, items, subcategories };
});

// Prepare all items with their data for client-side filtering
const allItemsForSearch = contentItems.map(item => ({
  slug: item.slug.replace('en/', ''),
  title: item.data.title,
  description: item.data.description || '',
  category: item.data.category,
  tags: item.data.tags || [],
}));

// Total document count
const totalDocs = contentItems.length;
const totalTags = tagCounts.size;
---

<Layout title="Index | Physical AI" locale={locale}>
  <div class="doc-layout">
    <!-- Mobile sidebar toggle -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle navigation">
      <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>

    <!-- Left Sidebar: Full Navigation Tree -->
    <aside class="sidebar-left" id="sidebarLeft">
      <div class="sidebar-header">
        <a href="/en/knowledge/physical-ai" class="sidebar-title">
          Physical AI
        </a>
        <button class="sidebar-close" id="sidebarClose" aria-label="Close navigation">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <nav class="sidebar-nav">
        {/* Overview link */}
        <a href="/en/knowledge/physical-ai" class="overview-link">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
          </svg>
          Overview
        </a>

        {/* Browse link - active on this page */}
        <a href="/en/knowledge/physical-ai/browse" class="browse-link active">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          Index
        </a>

        {groupedContent.map((category) => (
          category.items.length > 0 && (
            <div class="nav-category" data-category={category.id}>
              <button
                class={`category-toggle category-toggle-${category.color} expanded`}
                data-expanded="true"
                aria-expanded="true"
              >
                <svg class="toggle-icon" width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
                <span class={`category-name color-${category.color}`}>{category.name}</span>
                <span class="category-count">{category.items.length}</span>
              </button>

              <div class="category-content expanded">
                {category.subcategories ? (
                  category.subcategories.map((sub) => (
                    <div class="nav-subcategory" data-subcategory={sub.id}>
                      <button
                        class="subcategory-toggle"
                        data-expanded="false"
                        aria-expanded="false"
                      >
                        <svg class="toggle-icon" width="10" height="10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                        <span class="subcategory-name">{sub.name}</span>
                        <span class="subcategory-count">{sub.items.length}</span>
                      </button>
                      <div class="subcategory-content">
                        {sub.items.map((item) => (
                          <a
                            href={`/en/knowledge/${item.slug.replace('en/', '')}`}
                            class={`nav-item nav-item-${category.color}`}
                          >
                            {item.data.title}
                          </a>
                        ))}
                      </div>
                    </div>
                  ))
                ) : (
                  category.items.map((item) => (
                    <a
                      href={`/en/knowledge/${item.slug.replace('en/', '')}`}
                      class={`nav-item nav-item-${category.color}`}
                    >
                      {item.data.title}
                    </a>
                  ))
                )}
              </div>
            </div>
          )
        ))}
      </nav>
    </aside>

    <!-- Overlay for mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <main class="doc-main">
      <div class="doc-container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
          <a href="/en/knowledge">Knowledge Base</a>
          <span class="separator">/</span>
          <a href="/en/knowledge/physical-ai">Physical AI</a>
          <span class="separator">/</span>
          <span class="current">Index</span>
        </nav>

        <!-- Article -->
        <article class="article">
          <header class="article-header">
            <h1 class="article-title">Index</h1>
            <p class="article-description">
              Browse all documents in the Physical AI knowledge base.
              <strong>{totalDocs}</strong> documents, <strong>{totalTags}</strong> tags
            </p>
          </header>

          <!-- Search & Filter -->
          <div class="search-filter">
            <div class="search-box">
              <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <input
                type="text"
                id="searchInput"
                placeholder="Search documents or tags..."
                autocomplete="off"
              />
              <button id="clearSearch" class="clear-btn" style="display: none;">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            <!-- Category Filter -->
            <div class="filter-chips">
              <button class="filter-chip active" data-category="all">All</button>
              {categories.map(cat => (
                <button class={`filter-chip chip-${cat.color}`} data-category={cat.id}>
                  {cat.name}
                </button>
              ))}
            </div>
          </div>

          <!-- View Tabs -->
          <div class="view-tabs">
            <button class="view-tab active" data-view="graph">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3" stroke-width="2"/>
                <circle cx="4" cy="6" r="2" stroke-width="2"/>
                <circle cx="20" cy="6" r="2" stroke-width="2"/>
                <circle cx="4" cy="18" r="2" stroke-width="2"/>
                <circle cx="20" cy="18" r="2" stroke-width="2"/>
                <path stroke-linecap="round" stroke-width="2" d="M6 7l4 3M14 10l4-3M6 17l4-3M14 14l4 3"/>
              </svg>
              Graph
            </button>
            <button class="view-tab" data-view="tags">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
              </svg>
              Tags
            </button>
            <button class="view-tab" data-view="list">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
              </svg>
              List
            </button>
          </div>

          <!-- Graph View -->
          <div class="view-content" id="graphView">
            <GraphView graphData={graphData} height="600px" locale={locale} />
          </div>

          <!-- Tags View -->
          <div class="view-content" id="tagsView" style="display: none;">
            <div class="tags-cloud">
              {sortedTags.map(([tag, count]) => (
                <button
                  class="tag-item"
                  data-tag={tag}
                  style={`--tag-size: ${Math.min(1 + count * 0.15, 1.8)}`}
                >
                  #{tag}
                  <span class="tag-count">{count}</span>
                </button>
              ))}
            </div>

            <!-- Filtered Results (shown when tag is selected) -->
            <div id="tagResults" class="tag-results" style="display: none;">
              <div class="results-header">
                <h3 id="resultsTitle">Search Results</h3>
                <button id="clearTagFilter" class="clear-filter-btn">
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                  Clear Filter
                </button>
              </div>
              <ul id="resultsList" class="doc-list"></ul>
            </div>
          </div>

          <!-- List View -->
          <div class="view-content" id="listView" style="display: none;">
            <div class="browse-content" id="browseContent">
              {groupedContent.map((category) => (
                category.items.length > 0 && (
                  <section class="browse-section" data-category={category.id}>
                    <div class="section-header">
                      <h2 class={`section-title color-${category.color}`}>
                        {category.name}
                        <span class="section-count">{category.items.length}</span>
                      </h2>
                      <p class="section-description">{category.description}</p>
                    </div>

                    {category.subcategories ? (
                      <div class="subcategory-list">
                        {category.subcategories.map((sub) => (
                          <div class="subcategory-group">
                            <h3 class="subcategory-title">{sub.name}</h3>
                            <ul class="doc-list">
                              {sub.items.map((item) => (
                                <li data-tags={JSON.stringify(item.data.tags || [])}>
                                  <a href={`/en/knowledge/${item.slug.replace('en/', '')}`} class="doc-link">
                                    <span class="doc-title">{item.data.title}</span>
                                    <span class="doc-desc">{item.data.description}</span>
                                  </a>
                                </li>
                              ))}
                            </ul>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <ul class="doc-list">
                        {category.items.map((item) => (
                          <li data-tags={JSON.stringify(item.data.tags || [])}>
                            <a href={`/en/knowledge/${item.slug.replace('en/', '')}`} class="doc-link">
                              <span class="doc-title">{item.data.title}</span>
                              <span class="doc-desc">{item.data.description}</span>
                            </a>
                          </li>
                        ))}
                      </ul>
                    )}
                  </section>
                )
              ))}
            </div>
          </div>

          <!-- Search Results (for search input) -->
          <div id="searchResults" class="search-results" style="display: none;">
            <div class="results-header">
              <h3 id="searchResultsTitle">Search Results</h3>
            </div>
            <ul id="searchResultsList" class="doc-list"></ul>
          </div>
        </article>
      </div>
    </main>
  </div>
</Layout>

<script define:vars={{ allItemsForSearch }}>
  // Sidebar toggle for mobile
  const toggle = document.getElementById('sidebarToggle');
  const close = document.getElementById('sidebarClose');
  const sidebar = document.getElementById('sidebarLeft');
  const overlay = document.getElementById('sidebarOverlay');

  function openSidebar() {
    sidebar?.classList.add('open');
    overlay?.classList.add('show');
    document.body.style.overflow = 'hidden';
  }

  function closeSidebar() {
    sidebar?.classList.remove('open');
    overlay?.classList.remove('show');
    document.body.style.overflow = '';
  }

  toggle?.addEventListener('click', openSidebar);
  close?.addEventListener('click', closeSidebar);
  overlay?.addEventListener('click', closeSidebar);

  // Category toggle
  document.querySelectorAll('.category-toggle').forEach(button => {
    button.addEventListener('click', () => {
      const isExpanded = button.getAttribute('data-expanded') === 'true';
      const content = button.nextElementSibling;

      button.setAttribute('data-expanded', String(!isExpanded));
      button.setAttribute('aria-expanded', String(!isExpanded));
      button.classList.toggle('expanded', !isExpanded);
      content?.classList.toggle('expanded', !isExpanded);
    });
  });

  // Subcategory toggle
  document.querySelectorAll('.subcategory-toggle').forEach(button => {
    button.addEventListener('click', () => {
      const isExpanded = button.getAttribute('data-expanded') === 'true';
      const content = button.nextElementSibling;

      button.setAttribute('data-expanded', String(!isExpanded));
      button.setAttribute('aria-expanded', String(!isExpanded));
      button.classList.toggle('expanded', !isExpanded);
      content?.classList.toggle('expanded', !isExpanded);
    });
  });

  // View tabs
  const viewTabs = document.querySelectorAll('.view-tab');
  const graphView = document.getElementById('graphView');
  const tagsView = document.getElementById('tagsView');
  const listView = document.getElementById('listView');
  const searchResults = document.getElementById('searchResults');

  viewTabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const view = tab.getAttribute('data-view');

      // Update tabs
      viewTabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');

      // Show/hide views
      graphView.style.display = view === 'graph' ? 'block' : 'none';
      tagsView.style.display = view === 'tags' ? 'block' : 'none';
      listView.style.display = view === 'list' ? 'block' : 'none';

      // Hide search results when switching views
      if (searchResults) searchResults.style.display = 'none';
    });
  });

  // Search functionality
  const searchInput = document.getElementById('searchInput');
  const clearSearch = document.getElementById('clearSearch');
  const searchResultsList = document.getElementById('searchResultsList');
  const searchResultsTitle = document.getElementById('searchResultsTitle');

  let currentCategoryFilter = 'all';

  searchInput?.addEventListener('input', (e) => {
    const query = e.target.value.toLowerCase().trim();
    clearSearch.style.display = query ? 'flex' : 'none';

    if (!query) {
      searchResults.style.display = 'none';
      // Show current view
      const activeTab = document.querySelector('.view-tab.active');
      const view = activeTab?.getAttribute('data-view');
      if (view === 'graph') graphView.style.display = 'block';
      else if (view === 'tags') tagsView.style.display = 'block';
      else if (view === 'list') listView.style.display = 'block';
      return;
    }

    // Hide all views, show search results
    graphView.style.display = 'none';
    tagsView.style.display = 'none';
    listView.style.display = 'none';
    searchResults.style.display = 'block';

    // Filter items
    const filtered = allItemsForSearch.filter(item => {
      const matchesCategory = currentCategoryFilter === 'all' || item.category === currentCategoryFilter;
      const matchesQuery =
        item.title.toLowerCase().includes(query) ||
        item.description.toLowerCase().includes(query) ||
        item.tags.some(tag => tag.toLowerCase().includes(query));

      return matchesCategory && matchesQuery;
    });

    // Update results
    searchResultsTitle.textContent = `Search Results (${filtered.length} results)`;
    searchResultsList.innerHTML = filtered.map(item => `
      <li>
        <a href="/en/knowledge/${item.slug}" class="doc-link">
          <span class="doc-title">${item.title}</span>
          <span class="doc-desc">${item.description}</span>
          <div class="doc-tags">
            ${item.tags.map(tag => `<span class="doc-tag">#${tag}</span>`).join('')}
          </div>
        </a>
      </li>
    `).join('');
  });

  clearSearch?.addEventListener('click', () => {
    searchInput.value = '';
    clearSearch.style.display = 'none';
    searchResults.style.display = 'none';

    // Show current view
    const activeTab = document.querySelector('.view-tab.active');
    const view = activeTab?.getAttribute('data-view');
    if (view === 'graph') graphView.style.display = 'block';
    else if (view === 'tags') tagsView.style.display = 'block';
    else if (view === 'list') listView.style.display = 'block';
  });

  // Category filter chips
  const filterChips = document.querySelectorAll('.filter-chip');
  filterChips.forEach(chip => {
    chip.addEventListener('click', () => {
      filterChips.forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      currentCategoryFilter = chip.getAttribute('data-category');

      // Re-trigger search if there's a query
      if (searchInput.value.trim()) {
        searchInput.dispatchEvent(new Event('input'));
      }

      // Filter list view sections
      const sections = document.querySelectorAll('.browse-section');
      sections.forEach(section => {
        const sectionCategory = section.getAttribute('data-category');
        section.style.display =
          currentCategoryFilter === 'all' || sectionCategory === currentCategoryFilter
            ? 'block'
            : 'none';
      });
    });
  });

  // Tag click in tags view
  const tagItems = document.querySelectorAll('.tag-item');
  const tagResults = document.getElementById('tagResults');
  const resultsTitle = document.getElementById('resultsTitle');
  const resultsList = document.getElementById('resultsList');
  const clearTagFilter = document.getElementById('clearTagFilter');

  tagItems.forEach(tag => {
    tag.addEventListener('click', () => {
      const tagName = tag.getAttribute('data-tag');

      // Highlight selected tag
      tagItems.forEach(t => t.classList.remove('selected'));
      tag.classList.add('selected');

      // Filter items by tag
      const filtered = allItemsForSearch.filter(item =>
        item.tags.includes(tagName) &&
        (currentCategoryFilter === 'all' || item.category === currentCategoryFilter)
      );

      // Show results
      resultsTitle.textContent = `#${tagName} (${filtered.length} results)`;
      resultsList.innerHTML = filtered.map(item => `
        <li>
          <a href="/en/knowledge/${item.slug}" class="doc-link">
            <span class="doc-title">${item.title}</span>
            <span class="doc-desc">${item.description}</span>
          </a>
        </li>
      `).join('');
      tagResults.style.display = 'block';
    });
  });

  clearTagFilter?.addEventListener('click', () => {
    tagItems.forEach(t => t.classList.remove('selected'));
    tagResults.style.display = 'none';
  });
</script>

<style>
  .doc-layout {
    display: grid;
    grid-template-columns: 1fr;
    min-height: calc(100vh - 64px);
  }

  @media (min-width: 1024px) {
    .doc-layout {
      grid-template-columns: 280px 1fr;
    }
  }

  @media (min-width: 1280px) {
    .doc-layout {
      grid-template-columns: 300px 1fr;
    }
  }

  /* Mobile toggle button */
  .sidebar-toggle {
    position: fixed;
    bottom: 1.5rem;
    left: 1.5rem;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: var(--color-accent);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: transform 0.2s;
  }

  .sidebar-toggle:hover {
    transform: scale(1.05);
  }

  @media (min-width: 1024px) {
    .sidebar-toggle {
      display: none;
    }
  }

  /* Left Sidebar */
  .sidebar-left {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 300px;
    background: var(--color-bg-primary);
    border-right: 1px solid var(--color-border);
    z-index: 200;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    overflow-y: auto;
    padding-top: 64px;
  }

  .sidebar-left.open {
    transform: translateX(0);
  }

  @media (min-width: 1024px) {
    .sidebar-left {
      position: sticky;
      top: 64px;
      height: calc(100vh - 64px);
      transform: translateX(0);
      padding-top: 0;
      width: auto;
    }
  }

  .sidebar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1rem;
    border-bottom: 1px solid var(--color-border);
    position: sticky;
    top: 0;
    background: var(--color-bg-primary);
    z-index: 10;
  }

  .sidebar-title {
    font-size: 1rem;
    font-weight: 800;
    color: var(--color-accent);
    text-decoration: none;
    letter-spacing: -0.01em;
  }

  .sidebar-title:hover {
    opacity: 0.8;
  }

  .sidebar-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: transparent;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    border-radius: var(--radius-sm);
  }

  .sidebar-close:hover {
    background: var(--color-bg-secondary);
    color: var(--color-text-primary);
  }

  @media (min-width: 1024px) {
    .sidebar-close {
      display: none;
    }
  }

  .sidebar-nav {
    padding: 0;
  }

  /* Overview Link */
  .overview-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text-secondary);
    text-decoration: none;
    border-bottom: 1px solid var(--color-border);
    transition: all 0.15s;
  }

  .overview-link:hover {
    background: var(--color-bg-secondary);
    color: var(--color-text-primary);
  }

  .overview-link.active {
    background: var(--color-bg-secondary);
    color: var(--color-text-primary);
    border-left: 2px solid var(--color-text-primary);
  }

  .overview-link svg {
    flex-shrink: 0;
  }

  /* Browse Link */
  .browse-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text-secondary);
    text-decoration: none;
    border-bottom: 1px solid var(--color-border);
    transition: all 0.15s;
  }

  .browse-link:hover {
    background: var(--color-bg-secondary);
    color: var(--color-text-primary);
  }

  .browse-link.active {
    background: var(--color-bg-secondary);
    color: var(--color-text-primary);
    border-left: 2px solid var(--color-text-primary);
  }

  .browse-link svg {
    flex-shrink: 0;
  }

  /* Category Toggle */
  .nav-category {
    border-bottom: 1px solid var(--color-border);
  }

  .nav-category:last-child {
    border-bottom: none;
  }

  .category-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.75rem 1rem;
    background: transparent;
    border: none;
    cursor: pointer;
    text-align: left;
    transition: background 0.15s;
  }

  .category-toggle:hover {
    background: var(--color-bg-secondary);
  }

  .toggle-icon {
    flex-shrink: 0;
    color: var(--color-text-muted);
    transition: transform 0.2s;
  }

  .category-toggle.expanded .toggle-icon,
  .subcategory-toggle.expanded .toggle-icon {
    transform: rotate(90deg);
  }

  .category-name {
    flex: 1;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .color-blue { color: var(--color-blue); }
  .color-green { color: var(--color-green); }
  .color-purple { color: #a78bfa; }
  .color-yellow { color: var(--color-yellow); }
  .color-pink { color: #f472b6; }

  .category-count,
  .subcategory-count {
    font-size: 0.7rem;
    color: var(--color-text-muted);
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: 999px;
  }

  .category-content {
    display: none;
    padding-bottom: 0.5rem;
  }

  .category-content.expanded {
    display: block;
  }

  /* Subcategory Toggle */
  .nav-subcategory {
    margin-left: 0.5rem;
  }

  .subcategory-toggle {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    width: 100%;
    padding: 0.5rem 0.75rem;
    background: transparent;
    border: none;
    cursor: pointer;
    text-align: left;
    transition: background 0.15s;
  }

  .subcategory-toggle:hover {
    background: var(--color-bg-secondary);
  }

  .subcategory-name {
    flex: 1;
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--color-text-secondary);
  }

  .subcategory-content {
    display: none;
    margin-left: 1rem;
  }

  .subcategory-content.expanded {
    display: block;
  }

  /* Nav Items */
  .nav-item {
    display: block;
    padding: 0.375rem 1rem;
    font-size: 0.8rem;
    color: var(--color-text-muted);
    text-decoration: none;
    transition: all 0.15s;
    border-left: 2px solid transparent;
    margin-left: 0.5rem;
  }

  .nav-item:hover {
    color: var(--color-text-primary);
    background: var(--color-bg-secondary);
  }

  /* Overlay */
  .sidebar-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 150;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
  }

  .sidebar-overlay.show {
    opacity: 1;
    visibility: visible;
  }

  @media (min-width: 1024px) {
    .sidebar-overlay {
      display: none;
    }
  }

  /* Main Content */
  .doc-main {
    min-width: 0;
  }

  .doc-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
  }

  @media (min-width: 1024px) {
    .doc-container {
      padding: 2rem 2rem 4rem;
    }
  }

  /* Breadcrumb */
  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
    color: var(--color-text-muted);
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .breadcrumb a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color 0.2s;
  }

  .breadcrumb a:hover {
    color: var(--color-text-primary);
  }

  .separator {
    color: var(--color-border);
  }

  .current {
    color: var(--color-text-secondary);
  }

  /* Article */
  .article-header {
    margin-bottom: 1.5rem;
  }

  .article-title {
    font-size: clamp(1.75rem, 4vw, 2.25rem);
    font-weight: 800;
    color: var(--color-text-primary);
    margin-bottom: 0.5rem;
    line-height: 1.2;
  }

  .article-description {
    font-size: 1rem;
    color: var(--color-text-muted);
    line-height: 1.6;
  }

  .article-description strong {
    color: var(--color-text-primary);
  }

  /* Search & Filter */
  .search-filter {
    margin-bottom: 1.5rem;
  }

  .search-box {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    margin-bottom: 1rem;
  }

  .search-box svg {
    color: var(--color-text-muted);
    flex-shrink: 0;
  }

  .search-box input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: var(--color-text-primary);
    font-size: 0.95rem;
  }

  .search-box input::placeholder {
    color: var(--color-text-muted);
  }

  .clear-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: transparent;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    border-radius: var(--radius-sm);
  }

  .clear-btn:hover {
    color: var(--color-text-primary);
    background: var(--color-bg-primary);
  }

  .filter-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .filter-chip {
    padding: 0.375rem 0.75rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 999px;
    color: var(--color-text-muted);
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.15s;
  }

  .filter-chip:hover {
    border-color: var(--color-text-muted);
    color: var(--color-text-primary);
  }

  .filter-chip.active {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
  }

  .filter-chip.chip-yellow.active { background: #eab308; border-color: #eab308; }
  .filter-chip.chip-blue.active { background: #3b82f6; border-color: #3b82f6; }
  .filter-chip.chip-green.active { background: #10b981; border-color: #10b981; }
  .filter-chip.chip-purple.active { background: #a78bfa; border-color: #a78bfa; }
  .filter-chip.chip-pink.active { background: #f472b6; border-color: #f472b6; }

  /* View Tabs */
  .view-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--color-border);
  }

  .view-tab {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: transparent;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text-muted);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.15s;
  }

  .view-tab:hover {
    border-color: var(--color-text-muted);
    color: var(--color-text-primary);
  }

  .view-tab.active {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
  }

  /* Tags Cloud */
  .tags-cloud {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding: 1.5rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    margin-bottom: 1.5rem;
  }

  .tag-item {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.375rem 0.75rem;
    background: var(--color-bg-primary);
    border: 1px solid var(--color-border);
    border-radius: 999px;
    color: var(--color-text-secondary);
    font-size: calc(0.75rem * var(--tag-size, 1));
    cursor: pointer;
    transition: all 0.15s;
  }

  .tag-item:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
  }

  .tag-item.selected {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
  }

  .tag-count {
    font-size: 0.7em;
    opacity: 0.7;
  }

  /* Results */
  .tag-results,
  .search-results {
    margin-top: 1.5rem;
  }

  .results-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
  }

  .results-header h3 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text-primary);
  }

  .clear-filter-btn {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    background: transparent;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    color: var(--color-text-muted);
    font-size: 0.75rem;
    cursor: pointer;
  }

  .clear-filter-btn:hover {
    border-color: var(--color-text-muted);
    color: var(--color-text-primary);
  }

  /* Browse Content */
  .browse-content {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
  }

  .browse-section {
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--color-border);
  }

  .browse-section:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }

  .section-header {
    margin-bottom: 1.25rem;
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
  }

  .section-count {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--color-text-muted);
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.5rem;
    border-radius: 999px;
  }

  .section-description {
    font-size: 0.875rem;
    color: var(--color-text-muted);
  }

  .subcategory-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .subcategory-group {
    padding-left: 1rem;
    border-left: 2px solid var(--color-border);
  }

  .subcategory-title {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--color-text-secondary);
    margin-bottom: 0.75rem;
  }

  .doc-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .doc-link {
    display: block;
    padding: 0.75rem 1rem;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-decoration: none;
    transition: all 0.15s;
  }

  .doc-link:hover {
    border-color: var(--color-accent);
    background: var(--color-bg-secondary);
  }

  .doc-title {
    display: block;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin-bottom: 0.25rem;
  }

  .doc-link:hover .doc-title {
    color: var(--color-accent);
  }

  .doc-desc {
    display: block;
    font-size: 0.8rem;
    color: var(--color-text-muted);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .doc-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    margin-top: 0.5rem;
  }

  .doc-tag {
    font-size: 0.7rem;
    color: var(--color-text-muted);
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
  }
</style>
